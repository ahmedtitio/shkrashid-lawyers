# دليل إعداد نظام البريد الإلكتروني المباشر

## 📋 نظرة عامة
تم تحويل نظام الاستشارات إلى استخدام Serverless Functions لإرسال البريد الإلكتروني مباشرة دون وسيط.

## ⚙️ المتطلبات الأساسية

### 1. إعداد Gmail (مستحسن)
1. قم بتسجيل الدخول إلى حساب Gmail الخاص بك (ah01110692728@gmail.com)
2. تفعيل التحقق بخطوتين (Two-Factor Authentication)
3. إنشاء كلمة مرور للتطبيقات (App Password):
   - انتقل إلى إعدادات Gmail → الأمان → التحقق بخطوتين
   - في أسفل الصفحة، اختر "كلمات مرور التطبيقات"
   - أنشئ كلمة مرور جديدة للتطبيق واختر "بريد" كنوع الجهاز
   - احفظ كلمة المرور التي سيتم إنشاؤها

### 2. إعداد متغيرات البيئة
أنشئ ملف `.env.local` في مجلد المشروع الرئيسي وأضف المتغيرات التالية:

```env
SMTP_USER=ah01110692728@gmail.com
SMTP_PASS=your-app-password-here
NEXT_PUBLIC_SITE_URL=http://localhost:3000
```

استبدل `your-app-password-here` بكلمة مرور التطبيق التي أنشأتها في Gmail.

## 🔧 التكوين الحالي

### API Route
- الملف: `src/app/api/consultation/route.ts`
- الوظيفة: يستقبل بيانات النموذج ويرسل بريدين:
  1. إلى مكتب المحاماة (ah01110692728@gmail.com) بمعلومات الاستشارة
  2. إلى المرسل لتأكيد استلام الاستشارة

### Frontend
- الملف: `src/app/components/ConsultationPopup.tsx`
- الوظيفة: يرسل البيانات إلى API route ويعرض رسائل النجاح/الفشل

## 📧 تنسيق البريد الإلكتروني

### بريد إلى المكتب:
- الموضوع: استشارة جديدة: [موضوع الاستشارة]
- المحتوى: يحتوي على جميع معلومات العميل والرسالة
- التنسيق: HTML مع تصميم عربي متجاوب

### بريد تأكيد إلى المرسل:
- الموضوع: تم استلام استشارتك - مكتب المحاماة
- المحتوى: رسالة تأكيد مع تفاصيل الاستشارة
- التنسيق: HTML مع تصميم عربي متجاوب

## 🚀 النشر

### التطوير المحلي:
1. تأكد من تعبئة ملف `.env.local` بالمعلومات الصحيحة
2. قم بتشغيل المشروع: `npm run dev`
3. اختبر النموذج للتأكد من عمل البريد الإلكتروني

### النشر على Vercel:
1. أضف متغيرات البيئة في إعدادات Vercel:
   - `SMTP_USER`
   - `SMTP_PASS`
   - `NEXT_PUBLIC_SITE_URL`
2. قم بنشر المشروع

## 🛠️ استكشاف الأخطاء وإصلاحها

### إذا لم يتم إرسال البريد:
1. تحقق من صحة بيانات اعتماد Gmail
2. تأكد من تفعيل التحقق بخطوتين وكلمة مرور التطبيقات
3. تحقق من سجل الأخطاء في وحدة التحكم

### أخطاء شائعة:
- **Authentication failed**: بيانات الاعتماد غير صحيحة
- **Connection timeout**: مشاكل في الشبكة أو جدار الحماية
- **Rate limit exceeded**: تجاوز الحد المسموح من Gmail

## 🔒 الأمان

- لا يتم تخزين بيانات الاعتماد في الكود المصدر
- استخدام متغيرات البيئة للتكوين الحساس
- التحقق من صحة المدخلات على الخادم والعميل
- تحديد معدل الإرسال لمنع الإساءة

## 📞 الدعم

إذا واجهتك أي مشاكل:
1. تحقق من سجل الأخطاء في وحدة التحكم
2. تأكد من إعدادات Gmail وكلمة مرور التطبيقات
3. اختبر إرسال البريد يدوياً باستخدام بيانات الاعتماد

## 💡 نصائح إضافية

- يمكنك تغيير تنسيق البريد الإلكتروني في ملف `route.ts`
- يمكن إضافة حقول إضافية للنموذج حسب الحاجة
- يمكن تكوين خدمة بريد بديلة (مثل SendGrid) بدلاً من Gmail
